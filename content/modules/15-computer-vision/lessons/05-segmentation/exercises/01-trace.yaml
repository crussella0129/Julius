type: trace
id: "05-segmentation-trace-01"
prompt: "Trace through this connected components labeling and predict the output."
code: |
  import numpy as np

  binary = np.array([
      [1, 1, 0, 1],
      [1, 0, 0, 1],
      [0, 0, 0, 0],
      [0, 1, 1, 0],
  ])

  labels = np.zeros_like(binary, dtype=int)
  current = 0

  def fill(mask, labels, r, c, label):
      h, w = mask.shape
      queue = [(r, c)]
      labels[r, c] = label
      while queue:
          cr, cc = queue.pop(0)
          for dr, dc in [(-1,0),(1,0),(0,-1),(0,1)]:
              nr, nc = cr+dr, cc+dc
              if 0<=nr<h and 0<=nc<w and mask[nr,nc]==1 and labels[nr,nc]==0:
                  labels[nr, nc] = label
                  queue.append((nr, nc))

  for i in range(4):
      for j in range(4):
          if binary[i,j] == 1 and labels[i,j] == 0:
              current += 1
              fill(binary, labels, i, j, current)

  print(f"Objects: {current}")
  print(labels.tolist())
steps:
  - line: 3
    variables: {"binary": "4x4 binary mask with three separate regions"}
    output: ""
    explanation: "The mask has foreground pixels in three disconnected groups."
  - line: 25
    variables: {}
    output: ""
    explanation: "Scanning top-left to bottom-right: (0,0) starts label 1, flood-fills to (0,1) and (1,0)."
  - line: 25
    variables: {}
    output: ""
    explanation: "Next unlabeled foreground at (0,3) starts label 2, flood-fills to (1,3)."
  - line: 25
    variables: {}
    output: ""
    explanation: "Next unlabeled foreground at (3,1) starts label 3, flood-fills to (3,2)."
  - line: 29
    variables: {"current": 3}
    output: "Objects: 3"
    explanation: "Three separate connected components were found."
  - line: 30
    variables: {}
    output: "[[1, 1, 0, 2], [1, 0, 0, 2], [0, 0, 0, 0], [0, 3, 3, 0]]"
    explanation: "Label 1 for top-left group, label 2 for top-right, label 3 for bottom-middle."
expected_output: |
  Objects: 3
  [[1, 1, 0, 2], [1, 0, 0, 2], [0, 0, 0, 0], [0, 3, 3, 0]]
hints:
  - "Connected components only count 4-connected neighbors (up, down, left, right)."
  - "Diagonal pixels are NOT connected in this 4-connectivity scheme."
concept_tags:
  - connected-components
  - contour-detection
